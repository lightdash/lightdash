# Dependabot Alert #378: glob Command Injection Vulnerability

## Summary

| Field | Value |
|-------|-------|
| Package | `glob` |
| Current Version | `10.4.5` |
| Vulnerable Range | `>= 10.2.0, < 10.5.0` |
| Patched Version | `10.5.0` |
| **Affected** | **Yes** |

## Vulnerability Details

**CVE**: glob CLI Command Injection via -c/--cmd with shell:true

The glob package includes a CLI binary (`bin.mjs`) that allows executing commands with matched file paths using the `-c/--cmd` flag. In versions 10.2.0 to 10.4.5, this command execution uses `shell: true` unconditionally:

```javascript
// Vulnerable code in glob@10.4.5
foregroundChild(cmd, matches, { shell: true });
```

This allows command injection through specially crafted filenames that contain shell metacharacters. An attacker who can create files with malicious names could execute arbitrary commands when a user runs the glob CLI with the `-c` flag.

**Fix in 10.5.0**: The `shell` option now defaults to `false` and must be explicitly enabled via a `--shell` flag. The fix also includes a deprecation warning when `--shell` is used.

## Risk Assessment

**Risk Level**: Low to Medium for this codebase

The vulnerability is in the CLI binary of glob, not the programmatic API. For this vulnerability to be exploited:

1. An attacker would need to be able to create files with malicious filenames in a directory being globbed
2. A user would need to run the `glob` CLI directly with the `-c/--cmd` flag
3. The CLI would need to be executed on those files

**In this codebase**, glob is used as a transitive dependency by:
- `@tsoa/cli` (devDependency in backend) - for file matching during API generation
- `express-handlebars` (dependency in backend) - for template file discovery
- `snowflake-sdk` (dependency in warehouses) - for file operations
- `archiver-utils` (transitive via archiver in backend) - for archive operations

None of these packages use the glob CLI binary directly; they use the programmatic API which is **not affected** by this vulnerability. The programmatic glob API does not expose the vulnerable shell execution code.

## Upgrade Path

### Option 1: Use pnpm overrides (Recommended - Low Risk)

Add to root `package.json`:

```json
{
  "pnpm": {
    "overrides": {
      "glob@>=10.2.0 <10.5.0": "10.5.0"
    }
  }
}
```

Then run:
```bash
pnpm install
```

**Pros**: Minimal changes, fixes all transitive dependencies
**Cons**: May need to verify compatibility with dependent packages

### Option 2: Update direct dependencies

Some dependencies have newer versions that use patched glob:

| Package | Current | Latest | New glob version |
|---------|---------|--------|------------------|
| `express-handlebars` | ^7.1.2 | 8.0.4 | ^12.0.0 |
| `@tsoa/cli` | ^6.6.0 | 6.6.0 (latest) | ^10.3.10 (still vulnerable) |
| `snowflake-sdk` | ~2.3.1 | 2.3.3 | No glob dependency |

**Note**: `@tsoa/cli@6.6.0` still uses `glob@^10.3.10` which resolves to vulnerable versions. An override is needed for full remediation.

### Option 3: Wait for upstream fixes

Monitor `@tsoa/cli` for an update that uses glob >= 10.5.0.

## Recommended Action

1. **Immediate**: Add pnpm override to force `glob@10.5.0` for the vulnerable range
2. **Optional**: Update `express-handlebars` to v8.x (check for breaking changes first)
3. **Monitor**: Watch for `@tsoa/cli` updates

## Breaking Changes

### glob 10.4.5 to 10.5.0

No breaking changes in the programmatic API. The only change is to the CLI:
- `--shell` flag now defaults to `false` instead of `true`
- Deprecation warning added when `--shell` is used

Since this codebase does not use the glob CLI directly, there are no breaking changes expected.

### express-handlebars 7.x to 8.x

If upgrading express-handlebars:
- glob version jumps from ^10.x to ^12.x (major version change)
- Review express-handlebars changelog for any API changes

## Steps to Perform the Upgrade

```bash
# 1. Add override to package.json (at root level)
# Edit package.json and add under "pnpm" key:
#   "overrides": {
#     "glob@>=10.2.0 <10.5.0": "10.5.0"
#   }

# 2. Reinstall dependencies
pnpm install

# 3. Verify the fix
pnpm why glob

# 4. Run tests to ensure nothing broke
pnpm -F backend test:dev:nowatch
pnpm -F common test

# 5. Build and verify
pnpm typecheck
```

## Files to Modify

- `/package.json` - Add pnpm overrides section

## References

- Dependabot Alert: #378
- Glob package: https://www.npmjs.com/package/glob
- Patched version: https://www.npmjs.com/package/glob/v/10.5.0
