# Dependabot Alert #398: Next.js Denial of Service Vulnerability

## Package Information

| Field | Value |
|-------|-------|
| **Package** | `next` |
| **Current Version** | 15.4.8 |
| **Vulnerable Range** | >= 15.4.0-canary.0, < 15.4.9 |
| **Patched Version** | 15.4.10 (complete fix) |
| **Location** | `packages/sdk-next-test-app/package.json` |
| **CVE** | CVE-2025-55184 (initial), CVE-2025-67779 (complete fix) |
| **Severity** | High (CVSS 7.5) |

## Affected Status

**YES - This repository IS affected.**

### Reasons:
1. **Version is vulnerable**: Current version `15.4.8` is within the vulnerable range (>= 15.4.0-canary.0, < 15.4.9)
2. **Uses App Router**: The `sdk-next-test-app` package uses Next.js App Router (contains `src/app/` directory structure)
3. **Server Components**: App Router uses React Server Components by default, which is the attack vector

### Mitigating Factors:
- This is a **test application** (`sdk-next-test-app`), not a production service
- The app is marked as `"private": true`
- No server actions (`'use server'` directives) were found in the codebase
- The application appears to be used for SDK testing purposes only

## Vulnerability Details

### Description
A denial of service vulnerability exists in Next.js applications using the App Router. A specifically crafted HTTP request can be sent to any App Router endpoint that, when deserialized, causes an infinite loop that hangs the server process and prevents future HTTP requests from being served.

### Attack Vector
- **Network accessible**: No authentication required
- **No user interaction needed**: Attacker can directly exploit via crafted HTTP requests
- **Impact**: Server process hang, CPU consumption, complete denial of service

### Important Note on Patched Version
The Dependabot alert mentions `15.4.9` as the patched version, but **this is incomplete**. The initial fix for CVE-2025-55184 was found to be insufficient, and a complete fix was issued under CVE-2025-67779.

**The correct patched version for 15.4.x is `15.4.10`**, not `15.4.9`.

## Recommended Action

**Upgrade `next` from `15.4.8` to `15.4.10`**

## Breaking Changes Assessment

### 15.4.8 to 15.4.10
This is a **patch version upgrade** (15.4.8 -> 15.4.10), which should contain:
- Security fixes only
- No breaking changes expected
- No API changes

The upgrade path is straightforward as it stays within the same minor version (15.4.x).

## Dependencies That May Be Affected

When upgrading `next`, the following sub-dependencies will automatically be updated:
- `@next/env` (15.4.8 -> 15.4.10)
- `@next/swc-*` platform packages (15.4.8 -> 15.4.10)

No other packages in the monorepo depend on `next`.

## Upgrade Steps

1. **Update package.json**:
   ```bash
   cd packages/sdk-next-test-app
   pnpm update next@15.4.10
   ```

   Or manually edit `packages/sdk-next-test-app/package.json`:
   ```diff
   -        "next": "15.4.8",
   +        "next": "15.4.10",
   ```

2. **Install dependencies**:
   ```bash
   pnpm install
   ```

3. **Test the application**:
   ```bash
   pnpm -F @lightdash/sdk-next-test-app build
   pnpm -F @lightdash/sdk-next-test-app dev
   ```

4. **Verify the upgrade**:
   ```bash
   pnpm list next --filter @lightdash/sdk-next-test-app
   ```

## Risk Assessment

| Risk | Level | Notes |
|------|-------|-------|
| Breaking changes | Low | Patch version upgrade |
| Test failures | Low | Standard Next.js app, simple components |
| Build issues | Low | No complex configurations |
| Runtime issues | Low | Minimal application logic |

## Recommendation

**Priority: Medium**

While this is a high-severity vulnerability (CVSS 7.5), the affected package is:
- A test application, not production code
- Private and not deployed publicly
- Used only for SDK development/testing

However, upgrading is still recommended to:
1. Resolve the Dependabot alert
2. Follow security best practices
3. Prevent the test app from being an attack surface if ever exposed

## References

- [Next.js Security Update: December 11, 2025](https://nextjs.org/blog/security-update-2025-12-11)
- [GHSA-5j59-xgg2-r9c4 - GitHub Security Advisory](https://github.com/vercel/next.js/security/advisories/GHSA-5j59-xgg2-r9c4)
- [Vercel Security Bulletin: CVE-2025-55184 and CVE-2025-55183](https://vercel.com/kb/bulletin/security-bulletin-cve-2025-55184-and-cve-2025-55183)
