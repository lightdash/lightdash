# Dependabot Alert #364: Hono Improper Authorization Vulnerability

## Summary

| Field | Value |
|-------|-------|
| Package | `hono` |
| Current Version | `4.9.6` (via pnpm override) |
| Vulnerable Range | `>= 1.1.0, < 4.10.2` |
| Patched Version | `4.10.2` |
| CVE | CVE-2025-62610 |
| CVSS Score | 8.1 (High) |
| Advisory | [GHSA-m732-5p4w-x69g](https://github.com/honojs/hono/security/advisories/GHSA-m732-5p4w-x69g) |

## Is This Repo Affected?

**Likely NOT affected in practice, but upgrade is still recommended.**

### Analysis

The vulnerability (CVE-2025-62610) is specific to **Hono's JWT Auth Middleware** which lacks built-in validation for the `aud` (Audience) claim. This can cause token mix-up issues when:
- Multiple services share the same JWT issuer/keys
- The `aud` claim is used to distinguish tokens between services

### How Hono is Used in This Repo

Hono is a **transitive dependency** - it is not directly imported or used in the Lightdash codebase:

1. **Backend (`packages/backend`)**:
   - Pulled in via `@mastra/core@0.16.0`, `@mastra/evals@0.13.4`, and `mastra@0.10.15` (devDependency)
   - Mastra uses Hono for its internal server framework, not for JWT authentication

2. **Frontend (`packages/frontend`)**:
   - Pulled in via `@react-grab/claude-code@0.0.70` (devDependency)
   - Used for development tooling, not production code

### Lightdash JWT Implementation

Lightdash uses its own JWT implementation via the `jsonwebtoken` npm package (NOT Hono's JWT middleware):
- `/packages/backend/src/auth/lightdashJwt.ts` - Uses `jsonwebtoken` library for JWT encoding/decoding
- `/packages/backend/src/middlewares/jwtAuthMiddleware/` - Custom Express middleware (not Hono)

**The vulnerable Hono JWT middleware is NOT used anywhere in the Lightdash codebase.**

## Recommended Upgrade Action

Update the pnpm override in `/package.json` from:
```json
"hono": "^4.9.6"
```

To:
```json
"hono": "^4.10.2"
```

Then run:
```bash
pnpm install
```

## Breaking Changes

**None.** The upgrade from 4.9.6 to 4.10.2 has no breaking changes:
- The new `verification.aud` option for JWT middleware is additive
- Existing code continues to work without modification
- Minor type improvements and bug fixes only

## Upgrade Steps

1. Edit `/package.json`:
   ```diff
   "pnpm": {
       "overrides": {
   -       "hono": "^4.9.6",
   +       "hono": "^4.10.2",
           "linkifyjs": "^4.3.2",
   ```

2. Run `pnpm install` to update the lockfile

3. Verify the upgrade:
   ```bash
   ls node_modules/.pnpm/ | grep hono
   # Should show hono@4.10.2 or higher
   ```

4. Run the test suite to confirm no regressions:
   ```bash
   pnpm test
   ```

## Risk Assessment

| Factor | Risk Level | Notes |
|--------|------------|-------|
| Production Impact | Low | Hono is not used in Lightdash's production code |
| Breaking Changes | None | Upgrade path is clean |
| Dependency Compatibility | Low | Minor version bump, widely compatible |
| Urgency | Medium | While not exploitable in this codebase, good security hygiene to patch |

## References

- [GitHub Advisory](https://github.com/honojs/hono/security/advisories/GHSA-m732-5p4w-x69g)
- [CVE-2025-62610](https://github.com/advisories/GHSA-m732-5p4w-x69g)
- [Snyk Vulnerability Database](https://security.snyk.io/vuln/SNYK-JS-HONO-13669873)
