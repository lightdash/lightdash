version: 2
models:
  - name: fanouts_accounts
    meta:
      primary_key: account_id
      # This filter means that unless you are an admin, you can't see Enterprise account
      sql_filter: ${lightdash.attributes.is_admin_saas_demo} = 'true' or segment !=
        'Enterprise'
      description: List of all customer and prospective customer fanouts_accounts pulled from
        our CRM
      joins:
        - join: fanouts_deals
          sql_on: ${fanouts_accounts.account_id} = ${fanouts_deals.account_id}
          type: left
          relationship: one-to-many
          fields:
            [
              deal_id,
              unique_deals,
              new_deals,
              won_deals,
              lost_deals,
              stage,
              average_amount,
              total_amount,
              total_deal_value,
              total_won_amount,
              seats
            ]
        - join: fanouts_users
          relationship: many-to-many
          sql_on: ${fanouts_accounts.account_id} = ${fanouts_users.account_id} and ${fanouts_deals.stage} = 'Won'
          type: left
          fields:
            [
              user_id,
              unique_user_count,
              job_title,
              is_marketing_opted_in,
              unique_job_title_count,
              email,
              created_at,
              first_logged_in_at,
              experience_in_years,
              average_experience_in_years
            ]
        - join: fanouts_tracks
          relationship: one-to-many
          sql_on: ${fanouts_users.user_id} = ${fanouts_tracks.user_id}
          type: left
          fields: [ id, user_id, event_count, name, timestamp, days_since_user_created, event_count]
    columns:
      - name: account_id
        description: "The Account ID from our database"
        meta:
          dimension:
            type: string
            urls:
              - label: 'Open in CRM'
                url: https://demo_saas.com/example/account/${ value.raw }
          metrics:
            deals_seats_metric:
              type: sum
              description: "Sum of all deal seats for this account"
              sql: ${fanouts_deals.seats}
            unique_accounts:
              type: count_distinct
              description: The unique number of fanouts_accounts based on distinct Account IDs
              spotlight:
                visibility: show
            unique_smb_accounts:
              label: Unique SMB fanouts_accounts
              type: count_distinct
              description: The unique number of fanouts_accounts based on distinct Account IDs for
                fanouts_accounts in the SMB Segment
              filters:
                - segment: 'SMB'
            unique_midmarket_accounts:
              label: Unique Midmarket fanouts_accounts
              type: count_distinct
              description: The unique number of Midmarket fanouts_accounts based on distinct Account
                IDs for fanouts_accounts in the Midmarket Segment
              filters:
                - segment: 'Midmarket'
            unique_enterprise_accounts:
              label: Unique Enterprise Accounts
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs for
                accounts in the Enterprise Segment
              filters:
                - segment: 'Enterprise'
      - name: account_name
        description: "Name of this company account"
        meta:
          dimension:
            type: string
      - name: industry
        description: "Stock market industry for this account"
        meta:
          dimension:
            type: string
      - name: segment
        description: "The market Segment for this account (SMB, Midmarket, Enterprise)"
        meta:
          dimension:
            type: string
      - name: estimated_annual_recurring_revenue
        description: "Estimated annual recurring revenue for this business"
        meta:
          dimension:
            type: number
          metrics:
            total_estimated_annual_recurring_revenue:
              type: sum
              label: "Total Estimated Annual Recurring Revenue"
              description: "Sum of all estimated annual recurring revenue"
              format: 'usd'
      - name: numeric_dim
        description: "A numeric dimension for testing purposes"
        meta:
          dimension:
            type: number