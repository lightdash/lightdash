version: 2
models:
  - name: fm_service_contracts
    description: Service agreements and customer contracts
    config:
      tags: ["core"]
      meta:
        primary_key: contract_id
        joins:
          - join: fm_buildings
            sql_on: ${fm_buildings.building_id} = ${fm_service_contracts.building_id}
            relationship: many-to-one
    columns:
      - name: contract_id
        description: Unique identifier
        meta:
          dimension:
            type: number
          metrics:
            total_count:
              type: count
              description: Total number of contracts
            unique_count:
              type: count_distinct
              description: Count of unique contracts

      - name: building_id
        description: Building reference
        meta:
          dimension:
            type: number

      - name: contract_number
        description: Contract reference number
        meta:
          dimension:
            type: string

      - name: status
        description: Current status
        meta:
          dimension:
            type: string

      - name: contract_type
        description: Type of agreement
        meta:
          dimension:
            type: string

      - name: service_level
        description: Service tier
        meta:
          dimension:
            type: string

      - name: monthly_recurring_revenue
        description: Monthly revenue
        meta:
          dimension:
            type: number
          metrics:
            total_mrr:
              type: sum
              description: Total monthly recurring revenue
            avg_mrr:
              type: average
              description: Average MRR per contract

      - name: annual_contract_value
        description: Annual contract value
        meta:
          dimension:
            type: number
          metrics:
            total_acv:
              type: sum
              description: Total ACV
            avg_acv:
              type: average
              description: Average ACV

      - name: total_work_orders_ytd
        description: Work orders year to date
        meta:
          dimension:
            type: number
          metrics:
            total_work_orders:
              type: sum
              description: Total work orders

      - name: completed_work_orders_ytd
        description: Completed work orders
        meta:
          dimension:
            type: number
          metrics:
            total_completed:
              type: sum
              description: Total completed

      - name: completion_rate
        description: Completion percentage
        meta:
          dimension:
            type: number
          metrics:
            avg_completion_rate:
              type: average
              format: percent
              description: Average completion rate

      - name: response_time_met_percent
        description: Response SLA compliance
        meta:
          dimension:
            type: number
          metrics:
            avg_response_sla:
              type: average
              format: percent
              description: Average response SLA met

      - name: resolution_time_met_percent
        description: Resolution SLA compliance
        meta:
          dimension:
            type: number
          metrics:
            avg_resolution_sla:
              type: average
              format: percent
              description: Average resolution SLA met

      - name: customer_satisfaction_score
        description: Customer satisfaction rating
        meta:
          dimension:
            type: number
          metrics:
            avg_satisfaction:
              type: average
              description: Average customer satisfaction

      - name: sla_compliance_score
        description: Overall SLA compliance
        meta:
          dimension:
            type: number
          metrics:
            avg_sla_compliance:
              type: average
              format: percent
              description: Average SLA compliance

      - name: total_service_cost_ytd
        description: Total service cost
        meta:
          dimension:
            type: number
          metrics:
            total_cost:
              type: sum
              description: Total service cost

      - name: profitability_percent
        description: Profitability percentage
        meta:
          dimension:
            type: number
          metrics:
            avg_profitability:
              type: average
              format: percent
              description: Average profitability

      - name: customer_rating
        description: Customer rating
        meta:
          dimension:
            type: number
          metrics:
            avg_rating:
              type: average
              description: Average customer rating

      - name: start_date
        description: Contract start date
        meta:
          dimension:
            type: date

      - name: end_date
        description: Contract end date
        meta:
          dimension:
            type: date

      - name: building_name
        description: Property name
        meta:
          dimension:
            type: string
