{"ast":null,"code":"/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar DragEvents =\n/** @class */\nfunction () {\n  function DragEvents() {\n    var _this = this;\n\n    this.handleMouseDown = function (event) {\n      _this.initCoordinateData(event);\n\n      if (_this.handler != null && _this.handler.onActivate != null) {\n        var exitCode = _this.handler.onActivate(event);\n\n        if (exitCode === false) {\n          return;\n        }\n      }\n\n      _this.isActivated = true;\n\n      _this.maybeAlterEventChain(event); // It is possible that the mouseup would not be called after the initial\n      // mousedown (for example if the mouse is moved out of the window). So,\n      // we preemptively detach to avoid duplicate listeners.\n\n\n      _this.detachDocumentEventListeners();\n\n      _this.attachDocumentEventListeners();\n    };\n\n    this.handleMouseMove = function (event) {\n      _this.maybeAlterEventChain(event);\n\n      if (_this.isActivated) {\n        _this.isDragging = true;\n      }\n\n      if (_this.isDragging) {\n        var coords = _this.updateCoordinateData(event);\n\n        if (_this.handler != null && _this.handler.onDragMove != null) {\n          _this.handler.onDragMove(event, coords);\n        }\n      }\n    };\n\n    this.handleMouseUp = function (event) {\n      _this.maybeAlterEventChain(event);\n\n      if (_this.handler != null) {\n        if (_this.isDragging) {\n          var coords = _this.updateCoordinateData(event);\n\n          if (_this.handler.onDragMove != null) {\n            _this.handler.onDragMove(event, coords);\n          }\n\n          if (_this.handler.onDragEnd != null) {\n            _this.handler.onDragEnd(event, coords);\n          }\n        } else if (_this.isActivated) {\n          if (_this.handler.onDoubleClick != null) {\n            if (_this.doubleClickTimeoutToken == null) {\n              // if this the first click of a possible double-click,\n              // we delay the firing of the click event by the\n              // timeout.\n              _this.doubleClickTimeoutToken = window.setTimeout(function () {\n                delete _this.doubleClickTimeoutToken;\n\n                if (_this.handler.onClick != null) {\n                  _this.handler.onClick(event);\n                }\n              }, DragEvents.DOUBLE_CLICK_TIMEOUT_MSEC);\n            } else {\n              // otherwise, this is the second click in the double-\n              // click so we cancel the single-click timeout and\n              // fire the double-click event.\n              window.clearTimeout(_this.doubleClickTimeoutToken);\n              delete _this.doubleClickTimeoutToken;\n\n              _this.handler.onDoubleClick(event);\n            }\n          } else if (_this.handler.onClick != null) {\n            _this.handler.onClick(event);\n          }\n        }\n      }\n\n      _this.isActivated = false;\n      _this.isDragging = false;\n\n      _this.detachDocumentEventListeners();\n    };\n  }\n  /**\n   * Returns true if the event includes a modifier key that often adds the result of the drag\n   * event to any existing state. For example, holding CTRL before dragging may select another\n   * region in addition to an existing one, while the absence of a modifier key may clear the\n   * existing selection first.\n   *\n   * @param event the mouse event for the drag interaction\n   */\n\n\n  DragEvents.isAdditive = function (event) {\n    return event.ctrlKey || event.metaKey;\n  };\n\n  DragEvents.prototype.attach = function (element, handler) {\n    this.detach();\n    this.handler = handler;\n    this.element = element;\n\n    if (this.isValidDragHandler(handler)) {\n      this.element.addEventListener(\"mousedown\", this.handleMouseDown);\n    }\n\n    return this;\n  };\n\n  DragEvents.prototype.detach = function () {\n    if (this.element != null) {\n      this.element.removeEventListener(\"mousedown\", this.handleMouseDown);\n      this.detachDocumentEventListeners();\n    }\n  };\n\n  DragEvents.prototype.isValidDragHandler = function (handler) {\n    return handler != null && (handler.onActivate != null || handler.onDragMove != null || handler.onDragEnd != null || handler.onClick != null || handler.onDoubleClick != null);\n  };\n\n  DragEvents.prototype.attachDocumentEventListeners = function () {\n    document.addEventListener(\"mousemove\", this.handleMouseMove);\n    document.addEventListener(\"mouseup\", this.handleMouseUp);\n  };\n\n  DragEvents.prototype.detachDocumentEventListeners = function () {\n    document.removeEventListener(\"mousemove\", this.handleMouseMove);\n    document.removeEventListener(\"mouseup\", this.handleMouseUp);\n  };\n\n  DragEvents.prototype.initCoordinateData = function (event) {\n    this.activationCoordinates = [event.clientX, event.clientY];\n    this.lastCoordinates = this.activationCoordinates;\n  };\n\n  DragEvents.prototype.updateCoordinateData = function (event) {\n    var currentCoordinates = [event.clientX, event.clientY];\n    var deltaCoordinates = [currentCoordinates[0] - this.lastCoordinates[0], currentCoordinates[1] - this.lastCoordinates[1]];\n    var offsetCoordinates = [currentCoordinates[0] - this.activationCoordinates[0], currentCoordinates[1] - this.activationCoordinates[1]];\n    var data = {\n      activation: this.activationCoordinates,\n      current: currentCoordinates,\n      delta: deltaCoordinates,\n      last: this.lastCoordinates,\n      offset: offsetCoordinates\n    };\n    this.lastCoordinates = [event.clientX, event.clientY];\n    return data;\n  };\n\n  DragEvents.prototype.maybeAlterEventChain = function (event) {\n    if (this.handler.preventDefault) {\n      event.preventDefault();\n    }\n\n    if (this.handler.stopPropagation) {\n      event.stopPropagation();\n    }\n  };\n\n  DragEvents.DOUBLE_CLICK_TIMEOUT_MSEC = 500;\n  return DragEvents;\n}();\n\nexport { DragEvents };","map":{"version":3,"sources":["../../../src/interactions/dragEvents.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar DragEvents = /** @class */ (function () {\n    function DragEvents() {\n        var _this = this;\n        this.handleMouseDown = function (event) {\n            _this.initCoordinateData(event);\n            if (_this.handler != null && _this.handler.onActivate != null) {\n                var exitCode = _this.handler.onActivate(event);\n                if (exitCode === false) {\n                    return;\n                }\n            }\n            _this.isActivated = true;\n            _this.maybeAlterEventChain(event);\n            // It is possible that the mouseup would not be called after the initial\n            // mousedown (for example if the mouse is moved out of the window). So,\n            // we preemptively detach to avoid duplicate listeners.\n            _this.detachDocumentEventListeners();\n            _this.attachDocumentEventListeners();\n        };\n        this.handleMouseMove = function (event) {\n            _this.maybeAlterEventChain(event);\n            if (_this.isActivated) {\n                _this.isDragging = true;\n            }\n            if (_this.isDragging) {\n                var coords = _this.updateCoordinateData(event);\n                if (_this.handler != null && _this.handler.onDragMove != null) {\n                    _this.handler.onDragMove(event, coords);\n                }\n            }\n        };\n        this.handleMouseUp = function (event) {\n            _this.maybeAlterEventChain(event);\n            if (_this.handler != null) {\n                if (_this.isDragging) {\n                    var coords = _this.updateCoordinateData(event);\n                    if (_this.handler.onDragMove != null) {\n                        _this.handler.onDragMove(event, coords);\n                    }\n                    if (_this.handler.onDragEnd != null) {\n                        _this.handler.onDragEnd(event, coords);\n                    }\n                }\n                else if (_this.isActivated) {\n                    if (_this.handler.onDoubleClick != null) {\n                        if (_this.doubleClickTimeoutToken == null) {\n                            // if this the first click of a possible double-click,\n                            // we delay the firing of the click event by the\n                            // timeout.\n                            _this.doubleClickTimeoutToken = window.setTimeout(function () {\n                                delete _this.doubleClickTimeoutToken;\n                                if (_this.handler.onClick != null) {\n                                    _this.handler.onClick(event);\n                                }\n                            }, DragEvents.DOUBLE_CLICK_TIMEOUT_MSEC);\n                        }\n                        else {\n                            // otherwise, this is the second click in the double-\n                            // click so we cancel the single-click timeout and\n                            // fire the double-click event.\n                            window.clearTimeout(_this.doubleClickTimeoutToken);\n                            delete _this.doubleClickTimeoutToken;\n                            _this.handler.onDoubleClick(event);\n                        }\n                    }\n                    else if (_this.handler.onClick != null) {\n                        _this.handler.onClick(event);\n                    }\n                }\n            }\n            _this.isActivated = false;\n            _this.isDragging = false;\n            _this.detachDocumentEventListeners();\n        };\n    }\n    /**\n     * Returns true if the event includes a modifier key that often adds the result of the drag\n     * event to any existing state. For example, holding CTRL before dragging may select another\n     * region in addition to an existing one, while the absence of a modifier key may clear the\n     * existing selection first.\n     *\n     * @param event the mouse event for the drag interaction\n     */\n    DragEvents.isAdditive = function (event) {\n        return event.ctrlKey || event.metaKey;\n    };\n    DragEvents.prototype.attach = function (element, handler) {\n        this.detach();\n        this.handler = handler;\n        this.element = element;\n        if (this.isValidDragHandler(handler)) {\n            this.element.addEventListener(\"mousedown\", this.handleMouseDown);\n        }\n        return this;\n    };\n    DragEvents.prototype.detach = function () {\n        if (this.element != null) {\n            this.element.removeEventListener(\"mousedown\", this.handleMouseDown);\n            this.detachDocumentEventListeners();\n        }\n    };\n    DragEvents.prototype.isValidDragHandler = function (handler) {\n        return (handler != null &&\n            (handler.onActivate != null ||\n                handler.onDragMove != null ||\n                handler.onDragEnd != null ||\n                handler.onClick != null ||\n                handler.onDoubleClick != null));\n    };\n    DragEvents.prototype.attachDocumentEventListeners = function () {\n        document.addEventListener(\"mousemove\", this.handleMouseMove);\n        document.addEventListener(\"mouseup\", this.handleMouseUp);\n    };\n    DragEvents.prototype.detachDocumentEventListeners = function () {\n        document.removeEventListener(\"mousemove\", this.handleMouseMove);\n        document.removeEventListener(\"mouseup\", this.handleMouseUp);\n    };\n    DragEvents.prototype.initCoordinateData = function (event) {\n        this.activationCoordinates = [event.clientX, event.clientY];\n        this.lastCoordinates = this.activationCoordinates;\n    };\n    DragEvents.prototype.updateCoordinateData = function (event) {\n        var currentCoordinates = [event.clientX, event.clientY];\n        var deltaCoordinates = [\n            currentCoordinates[0] - this.lastCoordinates[0],\n            currentCoordinates[1] - this.lastCoordinates[1],\n        ];\n        var offsetCoordinates = [\n            currentCoordinates[0] - this.activationCoordinates[0],\n            currentCoordinates[1] - this.activationCoordinates[1],\n        ];\n        var data = {\n            activation: this.activationCoordinates,\n            current: currentCoordinates,\n            delta: deltaCoordinates,\n            last: this.lastCoordinates,\n            offset: offsetCoordinates,\n        };\n        this.lastCoordinates = [event.clientX, event.clientY];\n        return data;\n    };\n    DragEvents.prototype.maybeAlterEventChain = function (event) {\n        if (this.handler.preventDefault) {\n            event.preventDefault();\n        }\n        if (this.handler.stopPropagation) {\n            event.stopPropagation();\n        }\n    };\n    DragEvents.DOUBLE_CLICK_TIMEOUT_MSEC = 500;\n    return DragEvents;\n}());\nexport { DragEvents };\n//# sourceMappingURL=dragEvents.js.map"]},"metadata":{},"sourceType":"module"}