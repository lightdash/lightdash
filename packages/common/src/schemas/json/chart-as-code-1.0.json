{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://schemas.lightdash.com/lightdash/chart-as-code.json",
    "title": "Lightdash Chart as Code",
    "description": "Schema for defining Lightdash charts in YAML format for version control",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "name",
        "tableName",
        "metricQuery",
        "tableConfig",
        "slug",
        "spaceSlug",
        "version",
        "updatedAt"
    ],
    "properties": {
        "version": {
            "type": "number",
            "description": "Schema version for this chart configuration",
            "const": 1
        },
        "name": {
            "type": "string",
            "description": "Display name of the chart",
            "minLength": 1
        },
        "description": {
            "type": "string",
            "description": "Optional description of what this chart displays"
        },
        "slug": {
            "type": "string",
            "description": "Unique identifier slug for this chart",
            "pattern": "^[a-z0-9-]+$"
        },
        "spaceSlug": {
            "type": "string",
            "description": "Path to the space containing this chart (e.g., 'sales/reports' or 'marketing')"
        },
        "tableName": {
            "type": "string",
            "description": "The explore/table name this chart queries from"
        },
        "dashboardSlug": {
            "type": ["string", "null"],
            "description": "Optional dashboard slug if this chart is saved within a dashboard",
            "pattern": "^[a-z0-9-]+$"
        },
        "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the chart was last updated (readonly)"
        },
        "downloadedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when this chart was downloaded from Lightdash (readonly)"
        },
        "metricQuery": {
            "type": "object",
            "description": "The query configuration defining what data to fetch",
            "additionalProperties": false,
            "required": [
                "exploreName",
                "dimensions",
                "metrics",
                "filters",
                "sorts",
                "limit",
                "tableCalculations"
            ],
            "properties": {
                "exploreName": {
                    "type": "string",
                    "description": "The name of the explore to query"
                },
                "dimensions": {
                    "type": "array",
                    "description": "List of dimension field IDs to include",
                    "items": {
                        "type": "string"
                    }
                },
                "metrics": {
                    "type": "array",
                    "description": "List of metric field IDs to include",
                    "items": {
                        "type": "string"
                    }
                },
                "filters": {
                    "type": "object",
                    "description": "Filter rules to apply to the query using 'and'/'or' filter groups",
                    "additionalProperties": false,
                    "properties": {
                        "dimensions": {
                            "oneOf": [
                                {
                                    "type": "array",
                                    "description": "Empty dimensions filter array (no filters applied)",
                                    "maxItems": 0
                                },
                                { "$ref": "#/$defs/filterGroup" }
                            ]
                        },
                        "metrics": {
                            "oneOf": [
                                {
                                    "type": "array",
                                    "description": "Empty metrics filter array (no filters applied)",
                                    "maxItems": 0
                                },
                                { "$ref": "#/$defs/filterGroup" }
                            ]
                        },
                        "tableCalculations": {
                            "oneOf": [
                                {
                                    "type": "array",
                                    "description": "Empty table calculations filter array (no filters applied)",
                                    "maxItems": 0
                                },
                                { "$ref": "#/$defs/filterGroup" }
                            ]
                        }
                    }
                },
                "sorts": {
                    "type": "array",
                    "description": "Sort configuration for query results",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["fieldId", "descending"],
                        "properties": {
                            "fieldId": {
                                "type": "string",
                                "description": "Field ID to sort by"
                            },
                            "descending": {
                                "type": "boolean",
                                "description": "Sort in descending order"
                            },
                            "nullsFirst": {
                                "type": "boolean",
                                "description": "Sort null values first"
                            }
                        }
                    }
                },
                "limit": {
                    "type": "number",
                    "description": "Maximum number of rows to return",
                    "minimum": 1
                },
                "metricOverrides": {
                    "type": "object",
                    "description": "Override formatting and display options for existing metrics",
                    "additionalProperties": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                            "formatOptions": {
                                "type": "object",
                                "description": "Formatting configuration for the metric",
                                "additionalProperties": false,
                                "properties": {
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "currency",
                                            "number",
                                            "percent"
                                        ],
                                        "description": "Format type"
                                    },
                                    "round": {
                                        "type": "number",
                                        "description": "Number of decimal places"
                                    },
                                    "currency": {
                                        "type": "string",
                                        "description": "Currency code (e.g., USD, GBP, EUR)"
                                    },
                                    "separator": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "commaPeriod",
                                            "spacePeriod",
                                            "periodComma",
                                            "spaceComma"
                                        ],
                                        "description": "Thousands separator style"
                                    },
                                    "suffix": {
                                        "type": "string",
                                        "description": "Suffix to append to formatted values"
                                    },
                                    "prefix": {
                                        "type": "string",
                                        "description": "Prefix to prepend to formatted values"
                                    },
                                    "compact": {
                                        "type": "string",
                                        "enum": [
                                            "thousands",
                                            "millions",
                                            "billions",
                                            "trillions",
                                            "kilobytes",
                                            "megabytes",
                                            "gigabytes",
                                            "terabytes",
                                            "petabytes",
                                            "kibibytes",
                                            "mebibytes",
                                            "gibibytes",
                                            "tebibytes",
                                            "pebibytes"
                                        ],
                                        "description": "Compact format for large numbers (K, M, B, T) or byte units"
                                    }
                                }
                            },
                            "round": {
                                "type": "number",
                                "description": "Number of decimal places (shorthand for formatOptions.round)"
                            },
                            "format": {
                                "type": "string",
                                "description": "Format string (legacy format specification)"
                            },
                            "label": {
                                "type": "string",
                                "description": "Custom label for the metric"
                            },
                            "description": {
                                "type": "string",
                                "description": "Custom description for the metric"
                            },
                            "uuid": {
                                "type": "string",
                                "description": "UUID of the metric override"
                            }
                        }
                    }
                },
                "tableCalculations": {
                    "type": "array",
                    "description": "Custom calculations to perform on query results (like window functions)",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["name", "displayName"],
                        "oneOf": [
                            {
                                "required": ["sql"],
                                "not": { "required": ["template"] }
                            },
                            {
                                "required": ["template"],
                                "not": { "required": ["sql"] }
                            }
                        ],
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Internal name of the table calculation"
                            },
                            "displayName": {
                                "type": "string",
                                "description": "Display name shown in the UI"
                            },
                            "sql": {
                                "type": "string",
                                "description": "SQL expression for the calculation (can reference fields with ${table.field})"
                            },
                            "type": {
                                "type": "string",
                                "enum": ["string", "number", "date", "boolean"],
                                "description": "Data type of the calculation result"
                            },
                            "format": {
                                "type": "object",
                                "description": "Formatting options for the calculation",
                                "additionalProperties": false,
                                "properties": {
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "currency",
                                            "number",
                                            "percent"
                                        ],
                                        "description": "Format type"
                                    },
                                    "round": {
                                        "type": "number",
                                        "description": "Number of decimal places"
                                    },
                                    "currency": {
                                        "type": "string",
                                        "description": "Currency code (e.g., USD, GBP, EUR)"
                                    },
                                    "separator": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "commaPeriod",
                                            "spacePeriod",
                                            "periodComma",
                                            "spaceComma"
                                        ]
                                    },
                                    "suffix": {
                                        "type": "string",
                                        "description": "Suffix to append to formatted values"
                                    },
                                    "prefix": {
                                        "type": "string",
                                        "description": "Prefix to prepend to formatted values"
                                    },
                                    "compact": {
                                        "type": "string",
                                        "enum": [
                                            "thousands",
                                            "millions",
                                            "billions",
                                            "trillions",
                                            "kilobytes",
                                            "megabytes",
                                            "gigabytes",
                                            "terabytes",
                                            "petabytes",
                                            "kibibytes",
                                            "mebibytes",
                                            "gibibytes",
                                            "tebibytes",
                                            "pebibytes"
                                        ],
                                        "description": "Compact format for large numbers (K, M, B, T) or byte units"
                                    }
                                }
                            },
                            "template": {
                                "type": "object",
                                "description": "Template-based calculation (alternative to sql)",
                                "additionalProperties": false,
                                "required": ["type"],
                                "properties": {
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "percent_change_from_previous",
                                            "percent_of_previous_value",
                                            "percent_of_column_total",
                                            "rank_in_column",
                                            "running_total",
                                            "window_function"
                                        ],
                                        "description": "Type of template calculation"
                                    },
                                    "fieldId": {
                                        "type": ["string", "null"],
                                        "description": "Field ID to apply the template to"
                                    },
                                    "orderBy": {
                                        "type": "array",
                                        "description": "Fields to order by for window functions",
                                        "items": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "required": ["fieldId"],
                                            "properties": {
                                                "fieldId": {
                                                    "type": "string",
                                                    "description": "Field ID to order by"
                                                },
                                                "order": {
                                                    "type": ["string", "null"],
                                                    "enum": [
                                                        "asc",
                                                        "desc",
                                                        null
                                                    ],
                                                    "description": "Sort direction"
                                                }
                                            }
                                        }
                                    },
                                    "partitionBy": {
                                        "type": "array",
                                        "description": "Fields to partition by for window functions",
                                        "items": {
                                            "type": "string"
                                        }
                                    },
                                    "windowFunction": {
                                        "type": "string",
                                        "description": "Window function type (for window_function template)"
                                    },
                                    "frame": {
                                        "type": "object",
                                        "description": "Frame clause for window functions",
                                        "additionalProperties": false,
                                        "properties": {
                                            "frameType": {
                                                "type": "string",
                                                "description": "Type of frame (ROWS or RANGE)"
                                            },
                                            "start": {
                                                "type": "object",
                                                "description": "Start boundary of the frame",
                                                "additionalProperties": false,
                                                "properties": {
                                                    "type": {
                                                        "type": "string",
                                                        "description": "Boundary type"
                                                    },
                                                    "offset": {
                                                        "type": "number",
                                                        "description": "Offset for PRECEDING/FOLLOWING"
                                                    }
                                                }
                                            },
                                            "end": {
                                                "type": "object",
                                                "description": "End boundary of the frame",
                                                "additionalProperties": false,
                                                "required": ["type"],
                                                "properties": {
                                                    "type": {
                                                        "type": "string",
                                                        "description": "Boundary type"
                                                    },
                                                    "offset": {
                                                        "type": "number",
                                                        "description": "Offset for PRECEDING/FOLLOWING"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "additionalMetrics": {
                    "type": "array",
                    "description": "Custom metrics defined inline (ad-hoc metrics not in the dbt model)",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["name", "label", "sql", "table", "type"],
                        "properties": {
                            "name": {
                                "type": "string",
                                "description": "Internal name of the metric"
                            },
                            "label": {
                                "type": "string",
                                "description": "Display label for the metric"
                            },
                            "description": {
                                "type": "string",
                                "description": "Description of what the metric measures"
                            },
                            "sql": {
                                "type": "string",
                                "description": "SQL expression (e.g., ${TABLE}.column_name)"
                            },
                            "table": {
                                "type": "string",
                                "description": "Table name the metric belongs to"
                            },
                            "type": {
                                "type": "string",
                                "enum": [
                                    "count",
                                    "count_distinct",
                                    "sum",
                                    "average",
                                    "min",
                                    "max",
                                    "percentile",
                                    "median",
                                    "number",
                                    "string",
                                    "date",
                                    "timestamp",
                                    "boolean",
                                    "percent_of_previous",
                                    "percent_of_total",
                                    "running_total"
                                ],
                                "description": "Aggregation type"
                            },
                            "baseDimensionName": {
                                "type": "string",
                                "description": "Name of the base dimension/column this metric aggregates"
                            },
                            "uuid": {
                                "type": ["string", "null"],
                                "description": "Unique identifier for the metric (readonly)"
                            },
                            "hidden": {
                                "type": "boolean",
                                "description": "Whether the metric is hidden from users"
                            },
                            "percentile": {
                                "type": "number",
                                "description": "Percentile value for percentile metrics"
                            },
                            "index": {
                                "type": "number",
                                "description": "Display order index"
                            },
                            "round": {
                                "type": "number",
                                "description": "Number of decimal places"
                            },
                            "format": {
                                "type": "string",
                                "description": "Format string (legacy format specification)"
                            },
                            "generationType": {
                                "type": "string",
                                "description": "Type of generated metric (e.g., 'periodOverPeriod' for time comparison metrics)"
                            },
                            "baseMetricId": {
                                "type": "string",
                                "description": "ID of the base metric for generated metrics"
                            },
                            "timeDimensionId": {
                                "type": "string",
                                "description": "ID of the time dimension for period-over-period metrics"
                            },
                            "granularity": {
                                "type": "string",
                                "description": "Time granularity (e.g., 'MONTH', 'WEEK', 'DAY')"
                            },
                            "periodOffset": {
                                "type": "number",
                                "description": "Number of periods to offset for comparison"
                            },
                            "filters": {
                                "type": "array",
                                "description": "Filters to apply to this metric",
                                "items": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "required": ["target", "operator"],
                                    "properties": {
                                        "id": {
                                            "type": "string",
                                            "description": "Optional unique identifier for the filter"
                                        },
                                        "target": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "required": ["fieldRef"],
                                            "properties": {
                                                "fieldRef": {
                                                    "type": "string",
                                                    "description": "Field reference to filter on (e.g., 'table_name.field_name')"
                                                }
                                            }
                                        },
                                        "operator": {
                                            "type": "string",
                                            "description": "Filter operator",
                                            "enum": [
                                                "equals",
                                                "notEquals",
                                                "isNull",
                                                "notNull",
                                                "startsWith",
                                                "endsWith",
                                                "include",
                                                "doesNotInclude",
                                                "lessThan",
                                                "lessThanOrEqual",
                                                "greaterThan",
                                                "greaterThanOrEqual",
                                                "inThePast",
                                                "notInThePast",
                                                "inTheNext",
                                                "inTheCurrent",
                                                "notInTheCurrent",
                                                "inBetween",
                                                "notInBetween"
                                            ]
                                        },
                                        "values": {
                                            "type": "array",
                                            "description": "Values to filter by"
                                        },
                                        "settings": {
                                            "type": "object",
                                            "description": "Additional settings for date/time filters",
                                            "additionalProperties": false,
                                            "properties": {
                                                "unitOfTime": {
                                                    "type": "string",
                                                    "enum": [
                                                        "milliseconds",
                                                        "seconds",
                                                        "minutes",
                                                        "hours",
                                                        "days",
                                                        "weeks",
                                                        "months",
                                                        "quarters",
                                                        "years"
                                                    ],
                                                    "description": "Time unit for relative date filters"
                                                },
                                                "completed": {
                                                    "type": "boolean",
                                                    "description": "For date filters, whether to include completed periods"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "formatOptions": {
                                "type": "object",
                                "description": "Formatting configuration",
                                "additionalProperties": false,
                                "properties": {
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "currency",
                                            "number",
                                            "percent"
                                        ]
                                    },
                                    "round": {
                                        "type": "number",
                                        "description": "Number of decimal places"
                                    },
                                    "currency": {
                                        "type": "string",
                                        "description": "Currency code (e.g., USD, GBP, EUR)"
                                    },
                                    "separator": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "commaPeriod",
                                            "spacePeriod",
                                            "periodComma",
                                            "spaceComma"
                                        ]
                                    },
                                    "suffix": {
                                        "type": "string",
                                        "description": "Suffix to append to formatted values"
                                    },
                                    "prefix": {
                                        "type": "string",
                                        "description": "Prefix to prepend to formatted values"
                                    },
                                    "compact": {
                                        "type": "string",
                                        "enum": [
                                            "thousands",
                                            "millions",
                                            "billions",
                                            "trillions",
                                            "kilobytes",
                                            "megabytes",
                                            "gigabytes",
                                            "terabytes",
                                            "petabytes",
                                            "kibibytes",
                                            "mebibytes",
                                            "gibibytes",
                                            "tebibytes",
                                            "pebibytes"
                                        ],
                                        "description": "Compact format for large numbers (K, M, B, T) or byte units"
                                    }
                                }
                            }
                        }
                    }
                },
                "customDimensions": {
                    "type": "array",
                    "description": "Custom dimensions defined inline",
                    "items": {
                        "type": "object"
                    }
                },
                "dimensionOverrides": {
                    "type": "object",
                    "description": "Override formatting and display options for existing dimensions",
                    "additionalProperties": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                            "formatOptions": {
                                "type": "object",
                                "description": "Formatting configuration for the dimension",
                                "additionalProperties": false,
                                "properties": {
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "currency",
                                            "number",
                                            "percent"
                                        ],
                                        "description": "Format type"
                                    },
                                    "round": {
                                        "type": "number",
                                        "description": "Number of decimal places"
                                    },
                                    "currency": {
                                        "type": "string",
                                        "description": "Currency code (e.g., USD, GBP, EUR)"
                                    },
                                    "separator": {
                                        "type": "string",
                                        "enum": [
                                            "default",
                                            "commaPeriod",
                                            "spacePeriod",
                                            "periodComma",
                                            "spaceComma"
                                        ],
                                        "description": "Thousands separator style"
                                    },
                                    "suffix": {
                                        "type": "string",
                                        "description": "Suffix to append to formatted values"
                                    },
                                    "prefix": {
                                        "type": "string",
                                        "description": "Prefix to prepend to formatted values"
                                    },
                                    "compact": {
                                        "type": "string",
                                        "enum": [
                                            "thousands",
                                            "millions",
                                            "billions",
                                            "trillions",
                                            "kilobytes",
                                            "megabytes",
                                            "gigabytes",
                                            "terabytes",
                                            "petabytes",
                                            "kibibytes",
                                            "mebibytes",
                                            "gibibytes",
                                            "tebibytes",
                                            "pebibytes"
                                        ],
                                        "description": "Compact format for large numbers (K, M, B, T) or byte units"
                                    }
                                }
                            },
                            "label": {
                                "type": "string",
                                "description": "Custom label for the dimension"
                            },
                            "description": {
                                "type": "string",
                                "description": "Custom description for the dimension"
                            },
                            "uuid": {
                                "type": "string",
                                "description": "UUID of the dimension override"
                            }
                        }
                    }
                },
                "timezone": {
                    "type": "string",
                    "description": "Timezone for date/time values (e.g., 'America/Los_Angeles', 'UTC')"
                }
            }
        },
        "chartConfig": {
            "type": "object",
            "description": "Visualization configuration for the chart",
            "discriminator": { "propertyName": "type" },
            "oneOf": [
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "cartesian" },
                        "config": { "$ref": "#/$defs/cartesianChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "pie" },
                        "config": { "$ref": "#/$defs/pieChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "table" },
                        "config": { "$ref": "#/$defs/tableChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "big_number" },
                        "config": { "$ref": "#/$defs/bigNumber" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "funnel" },
                        "config": { "$ref": "#/$defs/funnelChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "treemap" },
                        "config": { "$ref": "#/$defs/treemapChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "gauge" },
                        "config": { "$ref": "#/$defs/gaugeChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "map" },
                        "config": { "$ref": "#/$defs/mapChart" }
                    }
                },
                {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["type"],
                    "properties": {
                        "type": { "const": "custom" },
                        "config": { "$ref": "#/$defs/customVis" }
                    }
                }
            ]
        },
        "tableConfig": {
            "type": "object",
            "description": "Table view configuration",
            "additionalProperties": false,
            "required": ["columnOrder"],
            "properties": {
                "columnOrder": {
                    "type": "array",
                    "description": "Order of columns in table view",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "pivotConfig": {
            "type": "object",
            "description": "Pivot table configuration",
            "additionalProperties": false,
            "properties": {
                "columns": {
                    "type": "array",
                    "description": "Fields to use as pivot columns",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "parameters": {
            "type": "object",
            "description": "Parameter values for the chart query, keyed by parameter name (e.g., 'model.param_name')",
            "additionalProperties": {
                "anyOf": [
                    { "type": "string" },
                    { "type": "number" },
                    { "type": "array", "items": { "type": "string" } },
                    { "type": "array", "items": { "type": "number" } }
                ]
            }
        }
    },
    "$defs": {
        "filterGroup": {
            "type": "object",
            "description": "Filter group containing filters combined with AND/OR logic",
            "additionalProperties": false,
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Optional unique identifier for the filter group"
                },
                "and": {
                    "type": "array",
                    "description": "Array of filters or nested groups combined with AND logic",
                    "items": { "$ref": "#/$defs/filterItem" }
                },
                "or": {
                    "type": "array",
                    "description": "Array of filters or nested groups combined with OR logic",
                    "items": { "$ref": "#/$defs/filterItem" }
                }
            }
        },
        "filterItem": {
            "description": "Either a filter rule or a nested filter group",
            "oneOf": [
                { "$ref": "#/$defs/filterRule" },
                { "$ref": "#/$defs/filterGroup" }
            ]
        },
        "filterRule": {
            "type": "object",
            "description": "A single filter rule",
            "additionalProperties": false,
            "required": ["target", "operator"],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Optional unique identifier for the filter"
                },
                "target": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["fieldId"],
                    "properties": {
                        "fieldId": {
                            "type": "string",
                            "description": "Field ID to filter on"
                        },
                        "tableName": {
                            "type": "string",
                            "description": "Table name the field belongs to"
                        },
                        "type": {
                            "type": "string",
                            "description": "Field type (e.g., 'string', 'number', 'date')"
                        },
                        "fieldFilterType": {
                            "type": "string",
                            "description": "Filter type hint (e.g., 'date' for date fields)"
                        }
                    }
                },
                "operator": {
                    "type": "string",
                    "description": "Filter operator",
                    "enum": [
                        "equals",
                        "notEquals",
                        "isNull",
                        "notNull",
                        "startsWith",
                        "endsWith",
                        "include",
                        "doesNotInclude",
                        "lessThan",
                        "lessThanOrEqual",
                        "greaterThan",
                        "greaterThanOrEqual",
                        "inThePast",
                        "notInThePast",
                        "inTheNext",
                        "inTheCurrent",
                        "notInTheCurrent",
                        "inBetween",
                        "notInBetween"
                    ]
                },
                "values": {
                    "type": "array",
                    "description": "Values to filter by"
                },
                "required": {
                    "type": "boolean",
                    "description": "Whether this filter is required"
                },
                "settings": {
                    "type": "object",
                    "description": "Additional settings for date/time filters",
                    "additionalProperties": false,
                    "properties": {
                        "unitOfTime": {
                            "type": "string",
                            "enum": [
                                "milliseconds",
                                "seconds",
                                "minutes",
                                "hours",
                                "days",
                                "weeks",
                                "months",
                                "quarters",
                                "years"
                            ],
                            "description": "Time unit for relative date filters"
                        },
                        "completed": {
                            "type": "boolean",
                            "description": "For date filters, whether to include completed periods"
                        }
                    }
                },
                "disabled": {
                    "type": "boolean",
                    "description": "Whether this filter is disabled"
                },
                "tileTargets": {
                    "type": "object",
                    "description": "Dashboard tile-specific filter targets (maps tile UUIDs to field IDs)"
                }
            }
        },
        "cartesianChart": {
            "type": ["object", "null"],
            "description": "Configuration for cartesian (line, bar, area, scatter) charts",
            "additionalProperties": false,
            "properties": {
                "layout": {
                    "type": "object",
                    "description": "Layout configuration for the chart axes and orientation",
                    "additionalProperties": false,
                    "properties": {
                        "xField": {
                            "type": "string",
                            "description": "Field ID to use for the X axis"
                        },
                        "yField": {
                            "type": "array",
                            "description": "Field IDs to use for the Y axis",
                            "items": { "type": "string" }
                        },
                        "flipAxes": {
                            "type": "boolean",
                            "description": "Swap X and Y axes (creates horizontal bar charts)"
                        },
                        "showGridX": {
                            "type": "boolean",
                            "description": "Show vertical grid lines"
                        },
                        "showGridY": {
                            "type": "boolean",
                            "description": "Show horizontal grid lines"
                        },
                        "showXAxis": {
                            "type": "boolean",
                            "description": "Show the X axis"
                        },
                        "showYAxis": {
                            "type": "boolean",
                            "description": "Show the Y axis"
                        },
                        "stack": {
                            "type": ["boolean", "string"],
                            "description": "Stack series together (true for default stacking, or string for stack group name)"
                        }
                    }
                },
                "eChartsConfig": {
                    "type": "object",
                    "description": "ECharts-specific configuration. Supports all ECharts options.",
                    "additionalProperties": false,
                    "properties": {
                        "legend": { "$ref": "#/$defs/echartsLegend" },
                        "grid": { "$ref": "#/$defs/echartsGrid" },
                        "series": {
                            "type": "array",
                            "description": "Chart series configuration",
                            "items": { "$ref": "#/$defs/series" }
                        },
                        "xAxis": {
                            "type": ["array", "null"],
                            "description": "X axis configuration",
                            "items": { "$ref": "#/$defs/xAxis" }
                        },
                        "yAxis": {
                            "type": ["array", "null"],
                            "description": "Y axis configuration",
                            "items": { "$ref": "#/$defs/axis" }
                        },
                        "title": {
                            "type": "object",
                            "description": "Chart title configuration",
                            "additionalProperties": false,
                            "properties": {
                                "text": {
                                    "type": "string",
                                    "description": "Title text"
                                },
                                "subtext": {
                                    "type": "string",
                                    "description": "Subtitle text"
                                },
                                "left": {
                                    "type": "string",
                                    "description": "Horizontal position"
                                },
                                "top": {
                                    "type": "string",
                                    "description": "Vertical position"
                                }
                            }
                        },
                        "tooltip": {
                            "description": "Tooltip configuration (string for formatter, object for full config)",
                            "oneOf": [
                                {
                                    "type": "string",
                                    "description": "Tooltip formatter template"
                                },
                                {
                                    "type": "object",
                                    "description": "Full tooltip configuration",
                                    "additionalProperties": false,
                                    "properties": {
                                        "show": {
                                            "type": "boolean",
                                            "description": "Show tooltip"
                                        },
                                        "trigger": {
                                            "type": "string",
                                            "enum": ["item", "axis", "none"],
                                            "description": "Tooltip trigger type"
                                        },
                                        "backgroundColor": {
                                            "type": "string",
                                            "description": "Tooltip background color"
                                        },
                                        "borderColor": {
                                            "type": "string",
                                            "description": "Tooltip border color"
                                        },
                                        "borderWidth": {
                                            "type": "number",
                                            "description": "Tooltip border width in pixels"
                                        },
                                        "formatter": {
                                            "type": "string",
                                            "description": "Tooltip content formatter (HTML template or function)"
                                        },
                                        "textStyle": {
                                            "type": "object",
                                            "description": "Tooltip text style",
                                            "additionalProperties": false,
                                            "properties": {
                                                "color": {
                                                    "type": "string",
                                                    "description": "Text color"
                                                },
                                                "fontSize": {
                                                    "type": "number",
                                                    "description": "Font size"
                                                },
                                                "fontWeight": {
                                                    "type": [
                                                        "string",
                                                        "number"
                                                    ],
                                                    "description": "Font weight"
                                                },
                                                "fontFamily": {
                                                    "type": "string",
                                                    "description": "Font family"
                                                }
                                            }
                                        }
                                    }
                                }
                            ]
                        },
                        "tooltipSort": {
                            "type": "string",
                            "description": "How to sort tooltip items",
                            "enum": [
                                "default",
                                "alphabetical",
                                "value_ascending",
                                "value_descending"
                            ]
                        },
                        "showAxisTicks": {
                            "type": "boolean",
                            "description": "Show tick marks on axes"
                        },
                        "axisLabelFontSize": {
                            "type": "number",
                            "description": "Font size for axis labels"
                        },
                        "axisTitleFontSize": {
                            "type": "number",
                            "description": "Font size for axis titles"
                        }
                    }
                },
                "metadata": {
                    "type": "object",
                    "description": "Metadata for series (colors, etc.)",
                    "additionalProperties": {
                        "type": "object",
                        "properties": {
                            "color": { "type": "string" }
                        }
                    }
                }
            }
        },
        "echartsLegend": {
            "type": "object",
            "description": "Legend configuration. Supports all ECharts legend options.",
            "additionalProperties": false,
            "properties": {
                "show": {
                    "type": "boolean",
                    "description": "Show the legend"
                },
                "type": {
                    "type": "string",
                    "enum": ["plain", "scroll"],
                    "description": "Legend type (plain or scrollable)"
                },
                "orient": {
                    "type": "string",
                    "enum": ["horizontal", "vertical"],
                    "description": "Legend orientation"
                },
                "top": { "type": "string", "description": "Top position" },
                "right": { "type": "string", "description": "Right position" },
                "bottom": {
                    "type": "string",
                    "description": "Bottom position"
                },
                "left": { "type": "string", "description": "Left position" },
                "width": { "type": "string", "description": "Legend width" },
                "height": { "type": "string", "description": "Legend height" },
                "align": {
                    "type": "string",
                    "enum": ["auto", "left", "right"],
                    "description": "Legend alignment"
                },
                "icon": {
                    "type": "string",
                    "enum": [
                        "circle",
                        "rect",
                        "roundRect",
                        "triangle",
                        "diamond",
                        "pin",
                        "arrow",
                        "none"
                    ],
                    "description": "Legend icon shape"
                }
            }
        },
        "echartsGrid": {
            "type": "object",
            "description": "Grid (chart area) configuration. Supports all ECharts grid options.",
            "additionalProperties": false,
            "properties": {
                "containLabel": {
                    "type": "boolean",
                    "description": "Whether the grid area contains axis labels"
                },
                "top": { "type": "string", "description": "Top padding" },
                "right": { "type": "string", "description": "Right padding" },
                "bottom": { "type": "string", "description": "Bottom padding" },
                "left": { "type": "string", "description": "Left padding" },
                "width": { "type": "string", "description": "Grid width" },
                "height": { "type": "string", "description": "Grid height" }
            }
        },
        "axis": {
            "type": "object",
            "description": "Axis configuration. Supports all ECharts axis options.",
            "additionalProperties": false,
            "properties": {
                "name": {
                    "type": "string",
                    "description": "Axis title"
                },
                "type": {
                    "type": "string",
                    "enum": ["value", "category", "time", "log"],
                    "description": "Axis type"
                },
                "position": {
                    "type": "string",
                    "enum": ["left", "right", "top", "bottom"],
                    "description": "Axis position"
                },
                "min": {
                    "type": "string",
                    "description": "Minimum value (or 'dataMin' for auto)"
                },
                "max": {
                    "type": "string",
                    "description": "Maximum value (or 'dataMax' for auto)"
                },
                "minOffset": {
                    "type": "string",
                    "description": "Offset from minimum value"
                },
                "maxOffset": {
                    "type": "string",
                    "description": "Offset from maximum value"
                },
                "inverse": {
                    "type": "boolean",
                    "description": "Reverse the axis direction"
                },
                "rotate": {
                    "type": "number",
                    "description": "Rotation angle for axis labels"
                },
                "axisLabel": {
                    "type": "object",
                    "description": "Axis label configuration",
                    "additionalProperties": false,
                    "properties": {
                        "show": {
                            "type": "boolean",
                            "description": "Show axis labels"
                        },
                        "rotate": {
                            "type": "number",
                            "description": "Label rotation angle"
                        },
                        "formatter": {
                            "type": "string",
                            "description": "Label formatter"
                        },
                        "fontSize": {
                            "type": "number",
                            "description": "Label font size"
                        }
                    }
                }
            }
        },
        "xAxis": {
            "type": "object",
            "description": "X axis configuration. Supports all ECharts xAxis options.",
            "additionalProperties": false,
            "properties": {
                "name": { "type": "string", "description": "Axis title" },
                "type": {
                    "type": "string",
                    "enum": ["value", "category", "time", "log"],
                    "description": "Axis type"
                },
                "position": {
                    "type": "string",
                    "enum": ["top", "bottom"],
                    "description": "X axis position"
                },
                "min": { "type": "string", "description": "Minimum value" },
                "max": { "type": "string", "description": "Maximum value" },
                "minOffset": {
                    "type": "string",
                    "description": "Offset from minimum"
                },
                "maxOffset": {
                    "type": "string",
                    "description": "Offset from maximum"
                },
                "inverse": {
                    "type": "boolean",
                    "description": "Reverse axis direction"
                },
                "rotate": {
                    "type": "number",
                    "description": "Label rotation angle"
                },
                "sortType": {
                    "type": "string",
                    "description": "How to sort the X axis",
                    "enum": ["default", "category", "bar_totals"]
                },
                "enableDataZoom": {
                    "type": "boolean",
                    "description": "Enable data zoom slider for this axis"
                },
                "axisLabel": {
                    "type": "object",
                    "description": "Axis label configuration",
                    "additionalProperties": false,
                    "properties": {
                        "show": {
                            "type": "boolean",
                            "description": "Show axis labels"
                        },
                        "rotate": {
                            "type": "number",
                            "description": "Label rotation angle"
                        },
                        "formatter": {
                            "type": "string",
                            "description": "Label formatter"
                        },
                        "fontSize": {
                            "type": "number",
                            "description": "Label font size"
                        }
                    }
                }
            }
        },
        "series": {
            "type": "object",
            "description": "Chart series configuration. Supports all ECharts series options.",
            "additionalProperties": false,
            "required": ["encode", "type"],
            "properties": {
                "encode": {
                    "type": "object",
                    "description": "Field references for this series",
                    "additionalProperties": false,
                    "required": ["xRef", "yRef"],
                    "properties": {
                        "xRef": { "$ref": "#/$defs/pivotReference" },
                        "yRef": { "$ref": "#/$defs/pivotReference" },
                        "x": {
                            "type": "string",
                            "description": "Hash of xRef (computed)"
                        },
                        "y": {
                            "type": "string",
                            "description": "Hash of yRef (computed)"
                        }
                    }
                },
                "type": {
                    "type": "string",
                    "description": "Series visualization type",
                    "enum": ["line", "bar", "scatter", "area"]
                },
                "stack": {
                    "type": "string",
                    "description": "Stack group name (series with same stack name are stacked)"
                },
                "stackLabel": {
                    "type": "object",
                    "description": "Stack total label configuration",
                    "additionalProperties": false,
                    "properties": {
                        "show": {
                            "type": "boolean",
                            "description": "Show stack total labels"
                        }
                    }
                },
                "name": {
                    "type": "string",
                    "description": "Display name for the series"
                },
                "color": {
                    "type": "string",
                    "description": "Color for the series (hex code)"
                },
                "yAxisIndex": {
                    "type": "number",
                    "description": "Index of Y axis to use (for dual Y axis charts)"
                },
                "xAxisIndex": {
                    "type": "number",
                    "description": "Index of X axis to use (for dual X axis charts)"
                },
                "label": {
                    "type": "object",
                    "description": "Data label configuration",
                    "additionalProperties": false,
                    "properties": {
                        "show": {
                            "type": "boolean",
                            "description": "Show data labels on points"
                        },
                        "position": {
                            "type": "string",
                            "enum": [
                                "left",
                                "top",
                                "right",
                                "bottom",
                                "inside"
                            ],
                            "description": "Position of data labels"
                        },
                        "showOverlappingLabels": {
                            "type": "boolean",
                            "description": "Show labels even when they overlap"
                        }
                    }
                },
                "hidden": {
                    "type": "boolean",
                    "description": "Hide this series from the chart"
                },
                "areaStyle": {
                    "type": "object",
                    "description": "Area fill style (presence indicates area chart)",
                    "additionalProperties": false,
                    "properties": {
                        "opacity": {
                            "type": "number",
                            "description": "Area fill opacity (0-1)"
                        },
                        "color": {
                            "type": "string",
                            "description": "Area fill color"
                        }
                    }
                },
                "lineStyle": {
                    "type": "object",
                    "description": "Line style configuration",
                    "additionalProperties": false,
                    "properties": {
                        "width": {
                            "type": "number",
                            "description": "Line width"
                        },
                        "type": {
                            "type": "string",
                            "enum": ["solid", "dashed", "dotted"],
                            "description": "Line type"
                        },
                        "color": {
                            "type": "string",
                            "description": "Line color"
                        }
                    }
                },
                "itemStyle": {
                    "type": "object",
                    "description": "Style for data points/items",
                    "additionalProperties": false,
                    "properties": {
                        "color": {
                            "description": "Item color (string or gradient object)"
                        },
                        "borderColor": {
                            "type": "string",
                            "description": "Item border color"
                        },
                        "borderWidth": {
                            "type": "number",
                            "description": "Item border width"
                        },
                        "opacity": {
                            "type": "number",
                            "description": "Item opacity (0-1)"
                        }
                    }
                },
                "symbol": {
                    "type": "string",
                    "description": "Symbol shape for data points",
                    "enum": [
                        "circle",
                        "rect",
                        "roundRect",
                        "triangle",
                        "diamond",
                        "pin",
                        "arrow",
                        "none"
                    ]
                },
                "symbolSize": {
                    "type": "number",
                    "description": "Size of data point symbols"
                },
                "barWidth": {
                    "type": ["string", "number"],
                    "description": "Width of bars (number for pixels, string for percentage)"
                },
                "showSymbol": {
                    "type": "boolean",
                    "description": "Show symbols/markers on data points"
                },
                "smooth": {
                    "type": "boolean",
                    "description": "Use smooth curves for line/area charts"
                },
                "markLine": { "$ref": "#/$defs/markLine" },
                "isFilteredOut": {
                    "type": "boolean",
                    "description": "Whether this series is currently filtered out"
                }
            }
        },
        "pivotReference": {
            "type": "object",
            "description": "Reference to a field, optionally with pivot values",
            "additionalProperties": false,
            "required": ["field"],
            "properties": {
                "field": {
                    "type": "string",
                    "description": "Field ID being referenced"
                },
                "pivotValues": {
                    "type": "array",
                    "description": "Pivot values for this reference (for pivoted data)",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["field", "value"],
                        "properties": {
                            "field": {
                                "type": "string",
                                "description": "Pivot field ID"
                            },
                            "value": {
                                "description": "Pivot value"
                            }
                        }
                    }
                }
            }
        },
        "markLine": {
            "type": "object",
            "description": "Reference line configuration. Supports all ECharts markLine options.",
            "additionalProperties": false,
            "properties": {
                "data": {
                    "type": "array",
                    "description": "Reference line data points",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["uuid"],
                        "properties": {
                            "yAxis": {
                                "type": "string",
                                "description": "Y axis value for horizontal line"
                            },
                            "xAxis": {
                                "type": "string",
                                "description": "X axis value for vertical line"
                            },
                            "name": {
                                "type": "string",
                                "description": "Name of the reference line"
                            },
                            "value": {
                                "type": "string",
                                "description": "Value to display"
                            },
                            "type": {
                                "type": "string",
                                "description": "Point type (e.g., 'average')"
                            },
                            "uuid": {
                                "type": "string",
                                "description": "Unique identifier for this mark line"
                            },
                            "lineStyle": {
                                "type": "object",
                                "additionalProperties": false,
                                "properties": {
                                    "color": { "type": "string" }
                                }
                            },
                            "label": {
                                "type": "object",
                                "additionalProperties": false,
                                "properties": {
                                    "formatter": { "type": "string" },
                                    "position": {
                                        "type": "string",
                                        "enum": ["start", "middle", "end"]
                                    }
                                }
                            },
                            "dynamicValue": {
                                "type": "string",
                                "enum": ["average"],
                                "description": "Dynamic value type"
                            }
                        }
                    }
                },
                "symbol": {
                    "type": "string",
                    "description": "Symbol at line endpoints"
                },
                "lineStyle": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "color": { "type": "string" },
                        "width": { "type": "number" },
                        "type": { "type": "string" }
                    }
                },
                "label": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "formatter": { "type": "string" }
                    }
                }
            }
        },
        "pieChart": {
            "type": ["object", "null"],
            "description": "Configuration for pie and donut charts. Supports additional ECharts pie options.",
            "additionalProperties": false,
            "properties": {
                "groupFieldIds": {
                    "type": "array",
                    "description": "Field IDs used for grouping/slicing the pie",
                    "items": { "type": "string" }
                },
                "metricId": {
                    "type": "string",
                    "description": "Field ID of the metric to display"
                },
                "isDonut": {
                    "type": "boolean",
                    "description": "Display as donut chart with hole in center"
                },
                "valueLabel": {
                    "type": "string",
                    "enum": ["hidden", "inside", "outside", "both"],
                    "description": "Position of value labels on slices"
                },
                "colors": {
                    "type": "object",
                    "description": "Custom colors for each slice by label",
                    "additionalProperties": { "type": "string" }
                },
                "eChartsConfig": {
                    "type": "object",
                    "description": "ECharts-specific pie chart configuration",
                    "additionalProperties": false,
                    "properties": {
                        "tooltip": {
                            "description": "Tooltip configuration",
                            "oneOf": [
                                {
                                    "type": "string",
                                    "description": "Tooltip formatter template"
                                },
                                {
                                    "type": "object",
                                    "description": "Full tooltip configuration",
                                    "additionalProperties": false,
                                    "properties": {
                                        "show": {
                                            "type": "boolean",
                                            "description": "Show tooltip"
                                        },
                                        "trigger": {
                                            "type": "string",
                                            "enum": ["item", "axis", "none"],
                                            "description": "Tooltip trigger type"
                                        },
                                        "backgroundColor": {
                                            "type": "string",
                                            "description": "Tooltip background color"
                                        },
                                        "borderColor": {
                                            "type": "string",
                                            "description": "Tooltip border color"
                                        },
                                        "borderWidth": {
                                            "type": "number",
                                            "description": "Tooltip border width in pixels"
                                        },
                                        "formatter": {
                                            "type": "string",
                                            "description": "Tooltip content formatter"
                                        },
                                        "textStyle": {
                                            "type": "object",
                                            "description": "Tooltip text style",
                                            "additionalProperties": false,
                                            "properties": {
                                                "color": {
                                                    "type": "string",
                                                    "description": "Text color"
                                                },
                                                "fontSize": {
                                                    "type": "number",
                                                    "description": "Font size"
                                                }
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                },
                "showValue": {
                    "type": "boolean",
                    "description": "Show the actual value on slices"
                },
                "showPercentage": {
                    "type": "boolean",
                    "description": "Show percentage on slices"
                },
                "groupLabelOverrides": {
                    "type": "object",
                    "description": "Custom labels for each group/slice",
                    "additionalProperties": { "type": "string" }
                },
                "groupColorOverrides": {
                    "type": "object",
                    "description": "Custom colors for each group/slice",
                    "additionalProperties": { "type": "string" }
                },
                "groupValueOptionOverrides": {
                    "type": "object",
                    "description": "Per-slice value display options",
                    "additionalProperties": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                            "valueLabel": {
                                "type": "string",
                                "enum": ["hidden", "inside", "outside"]
                            },
                            "showValue": { "type": "boolean" },
                            "showPercentage": { "type": "boolean" }
                        }
                    }
                },
                "groupSortOverrides": {
                    "type": "array",
                    "description": "Custom sort order for groups/slices",
                    "items": { "type": "string" }
                },
                "showLegend": {
                    "type": "boolean",
                    "description": "Show the chart legend"
                },
                "legendPosition": {
                    "type": "string",
                    "enum": [
                        "horizontal",
                        "vertical",
                        "left",
                        "right",
                        "top",
                        "bottom"
                    ],
                    "description": "Legend position/orientation"
                },
                "legendMaxItemLength": {
                    "type": "number",
                    "description": "Maximum character length for legend items"
                },
                "metadata": {
                    "type": "object",
                    "description": "Metadata for series (colors, etc.)",
                    "additionalProperties": {
                        "type": "object",
                        "properties": {
                            "color": { "type": "string" }
                        }
                    }
                }
            }
        },
        "funnelChart": {
            "type": ["object", "null"],
            "description": "Configuration for funnel charts. Supports additional ECharts funnel options.",
            "additionalProperties": false,
            "properties": {
                "dataInput": {
                    "type": "string",
                    "enum": ["row", "column"],
                    "description": "How data is structured (row-based or column-based)"
                },
                "fieldId": {
                    "type": "string",
                    "description": "Field ID to display in funnel"
                },
                "metadata": {
                    "type": "object",
                    "description": "Metadata for series (colors, etc.)",
                    "additionalProperties": {
                        "type": "object",
                        "properties": {
                            "color": { "type": "string" }
                        }
                    }
                },
                "labelOverrides": {
                    "type": "object",
                    "description": "Custom labels for funnel stages",
                    "additionalProperties": { "type": "string" }
                },
                "colorOverrides": {
                    "type": "object",
                    "description": "Custom colors for funnel stages",
                    "additionalProperties": { "type": "string" }
                },
                "labels": {
                    "type": "object",
                    "description": "Label display configuration",
                    "additionalProperties": false,
                    "properties": {
                        "position": {
                            "type": "string",
                            "enum": ["inside", "left", "right", "hidden"],
                            "description": "Position of labels"
                        },
                        "showValue": {
                            "type": "boolean",
                            "description": "Show the actual value"
                        },
                        "showPercentage": {
                            "type": "boolean",
                            "description": "Show percentage"
                        }
                    }
                },
                "showLegend": {
                    "type": "boolean",
                    "description": "Show the chart legend"
                },
                "legendPosition": {
                    "type": "string",
                    "enum": ["horizontal", "vertical"],
                    "description": "Legend orientation"
                }
            }
        },
        "bigNumber": {
            "type": ["object", "null"],
            "description": "Configuration for big number (single value) displays. Supports additional options.",
            "additionalProperties": false,
            "properties": {
                "label": {
                    "type": "string",
                    "description": "Custom label for the big number"
                },
                "selectedField": {
                    "type": "string",
                    "description": "Field ID to display as the big number"
                },
                "style": {
                    "type": "string",
                    "enum": [
                        "default",
                        "thousands",
                        "millions",
                        "billions",
                        "trillions",
                        "K",
                        "M",
                        "B",
                        "T"
                    ],
                    "description": "Number formatting style (compact notation)"
                },
                "showBigNumberLabel": {
                    "type": "boolean",
                    "description": "Show the label above the number"
                },
                "showTableNamesInLabel": {
                    "type": "boolean",
                    "description": "Include table name in the label"
                },
                "showComparison": {
                    "type": "boolean",
                    "description": "Show comparison with previous value"
                },
                "comparisonFormat": {
                    "type": "string",
                    "enum": ["raw", "percentage"],
                    "description": "Format for comparison value"
                },
                "flipColors": {
                    "type": "boolean",
                    "description": "Flip positive/negative colors (red for increase, green for decrease)"
                },
                "comparisonLabel": {
                    "type": "string",
                    "description": "Custom label for the comparison value"
                }
            }
        },
        "gaugeChart": {
            "type": ["object", "null"],
            "description": "Configuration for gauge charts. Supports additional ECharts gauge options.",
            "additionalProperties": false,
            "properties": {
                "selectedField": {
                    "type": "string",
                    "description": "Field ID for the gauge value"
                },
                "min": {
                    "type": "number",
                    "description": "Minimum value for the gauge"
                },
                "max": {
                    "type": "number",
                    "description": "Maximum value for the gauge"
                },
                "maxFieldId": {
                    "type": "string",
                    "description": "Field ID to use as the max value"
                },
                "showAxisLabels": {
                    "type": "boolean",
                    "description": "Show min/max labels on the gauge"
                },
                "sections": {
                    "type": "array",
                    "description": "Color sections/ranges for the gauge",
                    "items": { "$ref": "#/$defs/gaugeSection" }
                },
                "customLabel": {
                    "type": "string",
                    "description": "Custom label for the gauge value"
                },
                "showPercentage": {
                    "type": "boolean",
                    "description": "Show value as percentage"
                },
                "customPercentageLabel": {
                    "type": "string",
                    "description": "Custom label for the percentage display"
                }
            }
        },
        "gaugeSection": {
            "type": "object",
            "description": "A colored section/range in a gauge chart",
            "additionalProperties": false,
            "required": ["min", "max", "color"],
            "properties": {
                "min": {
                    "type": "number",
                    "description": "Start value for this section"
                },
                "max": {
                    "type": "number",
                    "description": "End value for this section"
                },
                "minFieldId": {
                    "type": "string",
                    "description": "Field ID to use as min value"
                },
                "maxFieldId": {
                    "type": "string",
                    "description": "Field ID to use as max value"
                },
                "color": {
                    "type": "string",
                    "description": "Color for this section (hex code)"
                }
            }
        },
        "treemapChart": {
            "type": ["object", "null"],
            "description": "Configuration for treemap charts. Supports additional ECharts treemap options.",
            "additionalProperties": false,
            "properties": {
                "visibleMin": {
                    "type": "number",
                    "description": "Minimum size for visible nodes"
                },
                "leafDepth": {
                    "type": "number",
                    "description": "Depth of leaf nodes to display"
                },
                "groupFieldIds": {
                    "type": "array",
                    "description": "Field IDs for hierarchical grouping",
                    "items": { "type": "string" }
                },
                "sizeMetricId": {
                    "type": "string",
                    "description": "Field ID for node size"
                },
                "colorMetricId": {
                    "type": "string",
                    "description": "Field ID for node color value"
                },
                "startColor": {
                    "type": "string",
                    "description": "Start color for color gradient (hex code)"
                },
                "endColor": {
                    "type": "string",
                    "description": "End color for color gradient (hex code)"
                },
                "useDynamicColors": {
                    "type": "boolean",
                    "description": "Use dynamic color scaling based on values"
                },
                "startColorThreshold": {
                    "type": "number",
                    "description": "Value threshold for start color"
                },
                "endColorThreshold": {
                    "type": "number",
                    "description": "Value threshold for end color"
                }
            }
        },
        "customVis": {
            "type": ["object", "null"],
            "description": "Configuration for custom visualizations. Accepts any configuration.",
            "additionalProperties": false,
            "properties": {
                "spec": {
                    "type": "object",
                    "description": "Custom visualization specification (Vega-Lite or other)"
                }
            }
        },
        "tableChart": {
            "type": ["object", "null"],
            "description": "Configuration for table visualizations. Supports additional options.",
            "additionalProperties": false,
            "properties": {
                "showColumnCalculation": {
                    "type": "boolean",
                    "description": "Show column totals/calculations"
                },
                "showRowCalculation": {
                    "type": "boolean",
                    "description": "Show row totals/calculations"
                },
                "showTableNames": {
                    "type": "boolean",
                    "description": "Show table names in column headers"
                },
                "hideRowNumbers": {
                    "type": "boolean",
                    "description": "Hide row number column"
                },
                "showRowNumbers": {
                    "type": "boolean",
                    "description": "Show row number column"
                },
                "showColumnTotals": {
                    "type": "boolean",
                    "description": "Show column totals row"
                },
                "showResultsTotal": {
                    "type": "boolean",
                    "description": "Show total results count"
                },
                "showSubtotals": {
                    "type": "boolean",
                    "description": "Show subtotal rows"
                },
                "metricsAsRows": {
                    "type": "boolean",
                    "description": "Display metrics as rows instead of columns"
                },
                "columns": {
                    "type": "object",
                    "description": "Column-specific configuration",
                    "additionalProperties": {
                        "$ref": "#/$defs/columnProperties"
                    }
                },
                "conditionalFormattings": {
                    "type": "array",
                    "description": "Conditional formatting rules",
                    "items": { "$ref": "#/$defs/conditionalFormattingConfig" }
                }
            }
        },
        "columnProperties": {
            "type": "object",
            "description": "Configuration for a table column",
            "additionalProperties": false,
            "properties": {
                "visible": {
                    "type": "boolean",
                    "description": "Whether the column is visible"
                },
                "name": {
                    "type": "string",
                    "description": "Custom display name for the column"
                },
                "frozen": {
                    "type": "boolean",
                    "description": "Freeze the column (stick to left side)"
                },
                "displayStyle": {
                    "type": "string",
                    "enum": ["text", "bar"],
                    "description": "How to display the cell value"
                },
                "color": {
                    "type": "string",
                    "description": "Color for bar display style (hex code)"
                }
            }
        },
        "conditionalFormattingConfig": {
            "type": "object",
            "description": "Conditional formatting rule configuration",
            "additionalProperties": false,
            "properties": {
                "target": {
                    "type": ["object", "null"],
                    "description": "Target field for the formatting rule",
                    "additionalProperties": false,
                    "properties": {
                        "fieldId": {
                            "type": "string",
                            "description": "Field ID to apply formatting to"
                        }
                    }
                },
                "color": {
                    "description": "Color for formatting (string for single color, object for range)",
                    "oneOf": [
                        { "type": "string" },
                        {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "start": {
                                    "type": "string",
                                    "description": "Start color for gradient"
                                },
                                "end": {
                                    "type": "string",
                                    "description": "End color for gradient"
                                }
                            }
                        }
                    ]
                },
                "rules": {
                    "type": "array",
                    "description": "Rules for single-color conditional formatting",
                    "items": { "$ref": "#/$defs/conditionalFormattingRule" }
                },
                "rule": {
                    "type": "object",
                    "description": "Rule for color range formatting",
                    "additionalProperties": false,
                    "properties": {
                        "min": {
                            "description": "Minimum value (number or 'auto')"
                        },
                        "max": {
                            "description": "Maximum value (number or 'auto')"
                        }
                    }
                },
                "applyTo": {
                    "type": "string",
                    "enum": ["cell", "text"],
                    "description": "Apply formatting to cell background or text"
                }
            }
        },
        "conditionalFormattingRule": {
            "type": "object",
            "description": "A single conditional formatting rule",
            "additionalProperties": false,
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the rule"
                },
                "operator": {
                    "type": "string",
                    "description": "Comparison operator",
                    "enum": [
                        "isNull",
                        "notNull",
                        "equals",
                        "notEquals",
                        "startsWith",
                        "endsWith",
                        "include",
                        "doesNotInclude",
                        "lessThan",
                        "lessThanOrEqual",
                        "greaterThan",
                        "greaterThanOrEqual",
                        "inThePast",
                        "notInThePast",
                        "inTheNext",
                        "inTheCurrent",
                        "notInTheCurrent",
                        "inBetween",
                        "notInBetween"
                    ]
                },
                "values": {
                    "type": "array",
                    "description": "Values to compare against"
                },
                "compareTarget": {
                    "type": ["object", "null"],
                    "description": "Target field to compare against",
                    "additionalProperties": false,
                    "properties": {
                        "fieldId": {
                            "type": "string",
                            "description": "Field ID to compare against"
                        }
                    }
                }
            }
        },
        "mapChart": {
            "type": ["object", "null"],
            "description": "Configuration for map visualizations. Supports additional options.",
            "additionalProperties": false,
            "properties": {
                "mapType": {
                    "type": "string",
                    "enum": ["USA", "world", "europe", "custom"],
                    "description": "Type of map to display"
                },
                "locationType": {
                    "type": "string",
                    "enum": ["scatter", "area", "heatmap"],
                    "description": "How to display location data"
                },
                "tileBackground": {
                    "type": "string",
                    "enum": [
                        "none",
                        "openstreetmap",
                        "light",
                        "dark",
                        "satellite"
                    ],
                    "description": "Map tile background style"
                },
                "customGeoJsonUrl": {
                    "type": "string",
                    "description": "URL to custom GeoJSON file"
                },
                "geoJsonPropertyKey": {
                    "type": "string",
                    "description": "Property key in GeoJSON to match against data"
                },
                "backgroundColor": {
                    "type": "string",
                    "description": "Background color for the map (hex code)"
                },
                "noDataColor": {
                    "type": "string",
                    "description": "Color for regions with no data (hex code)"
                },
                "latitudeFieldId": {
                    "type": "string",
                    "description": "Field ID for latitude values"
                },
                "longitudeFieldId": {
                    "type": "string",
                    "description": "Field ID for longitude values"
                },
                "locationFieldId": {
                    "type": "string",
                    "description": "Field ID for location/region names (area maps)"
                },
                "valueFieldId": {
                    "type": "string",
                    "description": "Field ID for the value to display"
                },
                "sizeFieldId": {
                    "type": "string",
                    "description": "Field ID for bubble size (scatter maps)"
                },
                "showLegend": {
                    "type": "boolean",
                    "description": "Show the map legend"
                },
                "saveMapExtent": {
                    "type": "boolean",
                    "description": "Save the current map zoom/position"
                },
                "colorRange": {
                    "type": "array",
                    "description": "Array of colors for the value gradient",
                    "items": { "type": "string" }
                },
                "defaultZoom": {
                    "type": "number",
                    "description": "Default zoom level"
                },
                "defaultCenterLat": {
                    "type": "number",
                    "description": "Default center latitude"
                },
                "defaultCenterLon": {
                    "type": "number",
                    "description": "Default center longitude"
                },
                "minBubbleSize": {
                    "type": "number",
                    "description": "Minimum bubble size for scatter maps"
                },
                "maxBubbleSize": {
                    "type": "number",
                    "description": "Maximum bubble size for scatter maps"
                },
                "heatmapConfig": {
                    "type": "object",
                    "description": "Configuration for heatmap visualization",
                    "additionalProperties": false,
                    "properties": {
                        "radius": {
                            "type": "number",
                            "description": "Radius of heat points"
                        },
                        "blur": {
                            "type": "number",
                            "description": "Blur amount for heat points"
                        },
                        "opacity": {
                            "type": "number",
                            "description": "Opacity of the heatmap layer"
                        }
                    }
                },
                "fieldConfig": {
                    "type": "object",
                    "description": "Field-specific configuration for tooltips",
                    "additionalProperties": { "$ref": "#/$defs/mapFieldConfig" }
                }
            }
        },
        "mapFieldConfig": {
            "type": "object",
            "description": "Configuration for a field in map tooltips",
            "additionalProperties": false,
            "properties": {
                "visible": {
                    "type": "boolean",
                    "description": "Whether to show this field in tooltips"
                },
                "label": {
                    "type": "string",
                    "description": "Custom label for the field"
                }
            }
        }
    }
}
